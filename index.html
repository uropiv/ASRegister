<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registro de Asistencia</title>
<style>
  /* 🔹 Fondo dinámico */
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    max-width: 720px;
    background: linear-gradient(120deg, #89f7fe, #66a6ff);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #333;
    transition: all 0.3s ease;
  }
  @keyframes gradientBG {
    0% {background-position:0% 50%}
    50% {background-position:100% 50%}
    100% {background-position:0% 50%}
  }

  h1 { text-align:center; margin-bottom:1rem; }
  p { text-align:center; }

  label { display:block; margin-top:1rem; font-weight:bold; }
  input {
    width:100%;
    padding:.6rem;
    margin-top:.3rem;
    border:2px solid #ccc;
    border-radius:8px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  input:focus {
    border-color:#66a6ff;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 0 8px rgba(102,166,255,0.6);
    outline:none;
  }

  button {
    padding:.8rem 1.2rem;
    font-size:1.1rem;
    border:none;
    border-radius:10px;
    color:white;
    margin-top:1rem;
    cursor:pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  #btnInicio { background:#28a745; }
  #btnFin { background:#dc3545; }
  button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 10px rgba(0,0,0,0.3);
  }
  button:disabled { opacity:0.6; cursor:not-allowed; }

  /* 🔹 Estado animado */
  #status {
    margin-top:1rem;
    font-weight:bold;
    padding:.6rem;
    border-radius:8px;
    text-align:center;
    animation: bounce 0.6s;
  }
  @keyframes bounce {
    0% { transform: translateY(-10px); opacity:0; }
    50% { transform: translateY(5px); opacity:1; }
    100% { transform: translateY(0); opacity:1; }
  }

  /* 🔹 Badge flotante */
  .badge {
    position: fixed;
    top:20px;
    right:20px;
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding:.6rem 1rem;
    border-radius:20px;
    font-weight:bold;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    opacity:0;
    transform: translateY(-20px);
    transition: all 0.5s ease;
  }
  .badge.show {
    opacity:1;
    transform: translateY(0);
  }

</style>
</head>
<body>
<h1>Control de Asistencia</h1>
<p>Complete sus datos antes de marcar asistencia.</p>

<label for="legajo">Legajo Personal</label>
<input id="legajo" type="text" placeholder="Ej: 12345">

<label for="jerarquia">Jerarquía</label>
<input id="jerarquia" type="text" placeholder="Ej: Cabo, Sargento, etc.">

<label for="apellidoNombre">Apellido y Nombre</label>
<input id="apellidoNombre" type="text" placeholder="Ej: Pérez Juan">

<label for="dni">Documento Nacional de Identidad (DNI)</label>
<input id="dni" type="text" placeholder="Ej: 12345678">

<button id="btnInicio">Iniciar servicio</button>
<button id="btnFin">Finalizar servicio</button>

<p id="status"></p>

<div class="badge" id="badge">✔ Registro enviado</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbzq2_wLVt_IOSvKz00mVbgYfe8pyX3JiaLUthKhITli_J3qwfz1-C_1LV6Htp9ZTML3/exec"; // <- reemplaza con tu URL
const status = document.getElementById('status');
const btnInicio = document.getElementById('btnInicio');
const btnFin = document.getElementById('btnFin');
const badge = document.getElementById('badge');

// 🔹 Cargar datos guardados
window.onload = () => {
  ["legajo","jerarquia","apellidoNombre","dni"].forEach(id => {
    if (localStorage.getItem(id)) document.getElementById(id).value = localStorage.getItem(id);
  });
};

// 🔹 Guardar datos
function guardarDatos(legajo, jerarquia, apellidoNombre, dni){
  localStorage.setItem("legajo", legajo);
  localStorage.setItem("jerarquia", jerarquia);
  localStorage.setItem("apellidoNombre", apellidoNombre);
  localStorage.setItem("dni", dni);
}

// 🔹 Mostrar mensaje con animación
function mostrarStatus(mensaje,tipo){
  status.textContent = mensaje;
  switch(tipo){
    case 'okInicio': status.style.color='green'; break;
    case 'okFin': status.style.color='red'; break;
    case 'warning': status.style.color='orange'; break;
    case 'error': status.style.color='darkred'; break;
    default: status.style.color='black';
  }
  setTimeout(()=>{status.textContent='';},5000);
  badge.textContent = mensaje;
  badge.classList.add('show');
  setTimeout(()=>{badge.classList.remove('show');},4000);
}

// 🔹 Enviar datos al Apps Script
async function sendToGAS(payload){
  const res = await fetch(GAS_URL,{
    method:'POST',
    headers:{'Content-Type':'text/plain;charset=UTF-8'},
    body:JSON.stringify(payload)
  });
  return res.json();
}

// 🔹 Registrar INICIO/FIN
async function registrar(tipo){
  const legajo = document.getElementById('legajo').value.trim();
  const jerarquia = document.getElementById('jerarquia').value.trim();
  const apellidoNombre = document.getElementById('apellidoNombre').value.trim();
  const dni = document.getElementById('dni').value.trim();

  if(!legajo||!jerarquia||!apellidoNombre||!dni){
    mostrarStatus('⚠️ Complete todos los campos.','warning');
    return;
  }

  guardarDatos(legajo,jerarquia,apellidoNombre,dni);
  mostrarStatus('📍 Solicitando ubicación...','warning');
  btnInicio.disabled=true; btnFin.disabled=true;

  if(!navigator.geolocation){
    mostrarStatus('❌ Geolocalización no soportada.','error');
    btnInicio.disabled=false; btnFin.disabled=false;
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos=>{
    const payload={
      legajo, jerarquia, apellidoNombre, dni,
      lat: pos.coords.latitude,
      lon: pos.coords.longitude,
      accuracy: pos.coords.accuracy,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      tipo
    };
    mostrarStatus('📤 Enviando...','warning');
    try{
      const r = await sendToGAS(payload);
      if(r && r.status==='ok'){
        mostrarStatus(tipo==='INICIO'?'✅ Registro de INICIO guardado.':'🛑 Registro de FIN guardado.',tipo==='INICIO'?'okInicio':'okFin');
      }else{
        mostrarStatus('⚠️ Respuesta del servidor: '+JSON.stringify(r),'warning');
      }
    }catch(err){
      mostrarStatus('❌ Error: '+err.message,'error');
    }finally{
      btnInicio.disabled=false; btnFin.disabled=false;
    }
  },err=>{
    mostrarStatus('❌ Error de geolocalización: '+err.message,'error');
    btnInicio.disabled=false; btnFin.disabled=false;
  },{enableHighAccuracy:true,timeout:15000,maximumAge:0});
}

btnInicio.addEventListener('click',()=>registrar('INICIO'));
btnFin.addEventListener('click',()=>registrar('FIN'));
</script>
</body>
</html>
