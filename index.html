<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Servicio</title>
</head>
<body>
  <h2>Registro de Servicio con Geolocalización</h2>
  <button id="btnInicio">Iniciar servicio</button>
  <button id="btnFin">Finalizar servicio</button>
  <p id="status"></p>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz6HbJERQX9Y7Qa5Z4Ats_uXJ0PTKFGUO5idUft2qbYLTmtmXQ2J40yTKA6_Y0fSHSG/exec"; // <-- poné acá la URL de tu Apps Script
    const status = document.getElementById('status');

    // 🔹 Función que envía datos al Apps Script
    async function sendToGAS(payload) {
      const res = await fetch(GAS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
        body: JSON.stringify(payload)
      });
      return res.json();
    }

    // 🔹 Función para registrar inicio o fin
    async function registrar(tipo) {
      status.textContent = 'Solicitando ubicación...';
      if (!navigator.geolocation) {
        status.textContent = 'Geolocalización no soportada.';
        return;
      }
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const payload = {
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          tipo: tipo
        };
        status.textContent = 'Enviando...';
        try {
          const r = await sendToGAS(payload);
          if (r && r.status === 'ok') {
            status.textContent = `Registro de ${tipo} guardado correctamente.`;
          } else {
            status.textContent = 'Respuesta del servidor: ' + JSON.stringify(r);
          }
        } catch (err) {
          status.textContent = 'Error: ' + err.message;
        }
      }, (err) => {
        status.textContent = 'Error de geolocalización: ' + err.message;
      }, { enableHighAccuracy:true });
    }

    // 🔹 Eventos de los botones
    document.getElementById('btnInicio').addEventListener('click', () => registrar('INICIO'));
    document.getElementById('btnFin').addEventListener('click', () => registrar('FIN'));
  </script>
</body>
</html>
