<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Registro de Asistencia</title>
  <style>
    body{font-family:Arial;margin:2rem;max-width:720px}
    button{padding:.6rem 1rem;font-size:1rem}
    #status{margin-top:1rem}
  </style>
</head>
<body>
  <h1>Registro de Asistencia</h1>
  <p>Presiona para enviar tu registro.</p>
  <button id="btn">Registrar ahora</button>
  <div id="status"></div>

  <script>
  // URL del Web App (Apps Script)
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbwIS-KfItKsFqrceGCqWgLsuV1qiztsj_PTEBC2Tk2kx6zrfq4eNjc6BtAEIO0jLsrD/exec'; // <- reemplaza

  const btn = document.getElementById('btn');
  const status = document.getElementById('status');

  async function sendToGAS(payload) {
    // Usa text/plain para evitar preflight CORS en muchos casos (evita application/json)
    const res = await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
      body: JSON.stringify(payload)
    });
    return res.json();
  }

  btn.addEventListener('click', () => {
    status.textContent = 'Solicitando ubicación...';
    if (!navigator.geolocation) {
      status.textContent = 'Geolocalización no soportada.';
      return;
    }
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const payload = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
      };
      status.textContent = 'Enviando...';
      try {
        const r = await sendToGAS(payload);
        if (r && r.status === 'ok') status.textContent = 'Registro guardado correctamente.';
        else status.textContent = 'Respuesta del servidor: ' + JSON.stringify(r);
      } catch (err) {
        status.textContent = 'Error al enviar: ' + err.message;
        console.error(err);
      }
    }, (err) => {
      status.textContent = 'Error de geolocalización: ' + err.message;
    }, { enableHighAccuracy:true, timeout:15000, maximumAge:0 });
  });
  </script>
</body>
</html>

